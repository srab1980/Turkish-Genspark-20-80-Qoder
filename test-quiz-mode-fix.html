<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Quiz Mode Fix</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 2rem;
            background: #f5f5f5;
            direction: rtl;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 1rem;
        }
        .test-button:hover {
            background: #5a67d8;
        }
        .log {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.5rem;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
        }
        .status {
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            margin: 0.5rem 0;
            font-weight: bold;
        }
        .status.success { background: #c6f6d5; color: #22543d; }
        .status.error { background: #fed7d7; color: #822727; }
        .status.warning { background: #feebc8; color: #7b341e; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ðŸŽ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ù†Ù…Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h1>
        <p>Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ù†Ù…Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­.</p>
        
        <div class="status" id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...</div>
        
        <div>
            <button class="test-button" onclick="testQuizModeSelection()">
                ðŸŽ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ù†Ù…Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            </button>
            <button class="test-button" onclick="testAutoStart()">
                ðŸš€ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            </button>
            <button class="test-button" onclick="testQuickStart()">
                âš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹
            </button>
            <button class="test-button" onclick="clearLog()">
                ðŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„
            </button>
        </div>
        
        <div class="log" id="testLog"></div>
    </div>

    <script>
        let testLog = document.getElementById('testLog');
        let status = document.getElementById('status');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            testLog.textContent += `[${timestamp}] ${message}\n`;
            testLog.scrollTop = testLog.scrollHeight;
            console.log(message);
        }
        
        function setStatus(message, type = 'info') {
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function clearLog() {
            testLog.textContent = '';
            setStatus('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„', 'success');
        }
        
        // Mock the necessary functions for testing
        function setupMockEnvironment() {
            // Mock learning mode manager
            if (!window.learningModeManager) {
                window.learningModeManager = {
                    startMode: function(modeId, data) {
                        log(`âœ… Learning mode manager started: ${modeId}`);
                        log(`ðŸ“Š Data: ${JSON.stringify(data, null, 2)}`);
                        return { success: true, mode: modeId };
                    },
                    modes: new Map([
                        ['quiz', { id: 'quiz', name: 'Quiz Mode' }],
                        ['flashcard', { id: 'flashcard', name: 'Flashcard Mode' }]
                    ])
                };
            }
            
            // Mock enhanced vocabulary data
            if (!window.enhancedVocabularyData) {
                window.enhancedVocabularyData = {
                    greetings: {
                        name: 'Greetings',
                        words: [
                            { id: 1, turkish: 'Merhaba', arabic: 'Ù…Ø±Ø­Ø¨Ø§', english: 'Hello' },
                            { id: 2, turkish: 'GÃ¼naydÄ±n', arabic: 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±', english: 'Good morning' }
                        ]
                    },
                    food: {
                        name: 'Food',
                        words: [
                            { id: 3, turkish: 'Ekmek', arabic: 'Ø®Ø¨Ø²', english: 'Bread' },
                            { id: 4, turkish: 'Su', arabic: 'Ù…Ø§Ø¡', english: 'Water' }
                        ]
                    }
                };
            }
            
            log('ðŸ”§ Mock environment setup complete');
        }
        
        function testQuizModeSelection() {
            log('ðŸŽ¯ Testing quiz mode selection...');
            
            try {
                if (!window.sideMenuFilters) {
                    throw new Error('sideMenuFilters not available');
                }
                
                // Test mode selection
                window.sideMenuFilters.handleModeSelection('quiz');
                log('âœ… Mode selection called successfully');
                
                // Check if mode was selected
                const filters = window.sideMenuFilters.getFilters();
                if (filters.mode === 'quiz') {
                    log('âœ… Quiz mode was selected correctly');
                    setStatus('Ù†Ù…Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!', 'success');
                } else {
                    throw new Error(`Expected quiz mode, got: ${filters.mode}`);
                }
                
            } catch (error) {
                log(`âŒ Error: ${error.message}`);
                setStatus('Ø®Ø·Ø£ ÙÙŠ Ù†Ù…Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'error');
            }
        }
        
        function testAutoStart() {
            log('ðŸš€ Testing auto-start functionality...');
            
            try {
                if (!window.sideMenuFilters) {
                    throw new Error('sideMenuFilters not available');
                }
                
                // First, select quiz mode (this should trigger auto-start)
                log('ðŸ“‹ Selecting quiz mode...');
                window.sideMenuFilters.handleModeSelection('quiz');
                
                // Give it a moment for auto-start logic
                setTimeout(() => {
                    const filters = window.sideMenuFilters.getFilters();
                    log(`ðŸ“Š Current filters: ${JSON.stringify(filters)}`);
                    
                    if (filters.categories && filters.categories.length > 0) {
                        log('âœ… Auto-category selection worked');
                        setStatus('Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!', 'success');
                    } else {
                        log('âš ï¸ No categories auto-selected');
                        setStatus('Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ø³ÙŠÙ†', 'warning');
                    }
                }, 100);
                
            } catch (error) {
                log(`âŒ Error: ${error.message}`);
                setStatus('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 'error');
            }
        }
        
        function testQuickStart() {
            log('âš¡ Testing quick start functionality...');
            
            try {
                if (!window.sideMenuFilters) {
                    throw new Error('sideMenuFilters not available');
                }
                
                // Test quick start
                window.sideMenuFilters.quickStart('quiz');
                log('âœ… Quick start called successfully');
                
                setStatus('Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!', 'success');
                
            } catch (error) {
                log(`âŒ Error: ${error.message}`);
                setStatus('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹', 'error');
            }
        }
        
        // Initialize when page loads
        window.addEventListener('load', function() {
            setupMockEnvironment();
            
            // Wait for potential side menu filters to load
            setTimeout(() => {
                if (window.sideMenuFilters) {
                    log('âœ… sideMenuFilters is available');
                    setStatus('Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'success');
                } else {
                    log('âš ï¸ sideMenuFilters not yet available, creating mock...');
                    // Create a simple mock for testing
                    window.sideMenuFilters = {
                        selectedModes: new Set(),
                        selectedCategories: new Set(),
                        categories: [
                            { id: 'greetings', name: 'Ø§Ù„ØªØ­ÙŠØ§Øª' },
                            { id: 'food', name: 'Ø§Ù„Ø·Ø¹Ø§Ù…' }
                        ],
                        
                        handleModeSelection: function(modeId) {
                            this.selectedModes.clear();
                            this.selectedModes.add(modeId);
                            log(`ðŸŽ¯ Mode selected: ${modeId}`);
                            
                            // Trigger auto-start logic
                            if (this.selectedCategories.size === 0) {
                                this.autoSelectDefaultCategory();
                            }
                        },
                        
                        autoSelectDefaultCategory: function() {
                            if (this.categories.length > 0) {
                                this.selectedCategories.add(this.categories[0].id);
                                log(`ðŸ“‚ Auto-selected category: ${this.categories[0].name}`);
                            }
                        },
                        
                        quickStart: function(modeId) {
                            this.handleModeSelection(modeId);
                            if (this.selectedCategories.size > 0) {
                                log(`ðŸš€ Quick starting ${modeId} mode`);
                                return this.applyFilters();
                            }
                        },
                        
                        applyFilters: function() {
                            const filters = this.getFilters();
                            log(`âœ¨ Applying filters: ${JSON.stringify(filters)}`);
                            
                            if (window.learningModeManager) {
                                return window.learningModeManager.startMode(filters.mode, {
                                    category: filters.categories[0]
                                });
                            }
                        },
                        
                        getFilters: function() {
                            return {
                                categories: Array.from(this.selectedCategories),
                                mode: Array.from(this.selectedModes)[0] || 'flashcard'
                            };
                        }
                    };
                    
                    setStatus('Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± (ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø©)', 'warning');
                }
            }, 1000);
        });
    </script>
</body>
</html>