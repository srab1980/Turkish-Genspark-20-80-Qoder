<!DOCTYPE html>
<html>
<head>
    <title>Direct Session Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            direction: rtl; 
        }
        .log { 
            background: #f5f5f5; 
            padding: 10px; 
            margin: 5px 0; 
            border-radius: 4px; 
            font-family: monospace; 
            direction: ltr; 
            text-align: left; 
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            margin: 5px; 
            border-radius: 4px; 
            cursor: pointer; 
        }
    </style>
</head>
<body>
    <h1>Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h1>
    <button onclick="runTest()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
    <button onclick="testVocabAccess()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙØ±Ø¯Ø§Øª</button>
    <button onclick="clearLogs()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
    
    <div id="logs"></div>

    <script>
        function addLog(message, type = 'info') {
            const logs = document.getElementById('logs');
            const logElement = document.createElement('div');
            logElement.className = 'log';
            logElement.style.backgroundColor = type === 'error' ? '#ffebee' : type === 'success' ? '#e8f5e9' : '#f5f5f5';
            logElement.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            logs.appendChild(logElement);
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        function testVocabAccess() {
            addLog('ğŸ” Testing vocabulary data access...');
            
            // Test if we can access the parent window
            if (window.parent && window.parent !== window) {
                addLog('ğŸ“± Testing parent window access...');
                
                const parentData = window.parent.enhancedVocabularyData;
                if (parentData) {
                    const categories = Object.keys(parentData);
                    addLog('âœ… Parent vocabulary data found: ' + categories.length + ' categories', 'success');
                    addLog('   Categories: ' + categories.slice(0, 5).join(', '));
                    
                    // Test specific categories
                    ['greetings', 'food', 'family'].forEach(cat => {
                        const data = parentData[cat];
                        if (data && data.words) {
                            addLog('   âœ… ' + cat + ': ' + data.words.length + ' words', 'success');
                        } else {
                            addLog('   âŒ ' + cat + ': no data', 'error');
                        }
                    });
                } else {
                    addLog('âŒ No parent vocabulary data', 'error');
                }
            }

            // Test direct access (if loaded in same context)
            if (typeof window.enhancedVocabularyData !== 'undefined') {
                addLog('âœ… Direct vocabulary data access available', 'success');
                const categories = Object.keys(window.enhancedVocabularyData);
                addLog('   Found ' + categories.length + ' categories');
            } else {
                addLog('âŒ No direct vocabulary data access', 'error');
            }
        }

        function runTest() {
            addLog('ğŸš€ Starting session test...');
            
            // Try different approaches to access the function
            let testFunction = null;
            
            if (typeof window.startNewFlashcardSession === 'function') {
                testFunction = window.startNewFlashcardSession;
                addLog('âœ… Found startNewFlashcardSession in current window', 'success');
            } else if (window.parent && typeof window.parent.startNewFlashcardSession === 'function') {
                testFunction = window.parent.startNewFlashcardSession;
                addLog('âœ… Found startNewFlashcardSession in parent window', 'success');
            } else {
                addLog('âŒ startNewFlashcardSession not found', 'error');
                return;
            }

            // Test the function
            try {
                addLog('ğŸ¯ Calling startNewFlashcardSession with greetings...');
                const result = testFunction({ categoryId: 'greetings' });
                addLog('âœ… Function completed, result: ' + result, 'success');
            } catch (error) {
                addLog('âŒ Function failed: ' + error.message, 'error');
                console.error('Full error:', error);
            }
        }

        // Auto-run tests after delay
        setTimeout(() => {
            addLog('ğŸ”„ Auto-running tests...');
            testVocabAccess();
            setTimeout(runTest, 2000);
        }, 3000);

        // Load main app in iframe to test integration
        window.addEventListener('load', () => {
            const iframe = document.createElement('iframe');
            iframe.src = '/';
            iframe.style.width = '0';
            iframe.style.height = '0';
            iframe.style.border = 'none';
            iframe.onload = () => {
                addLog('ğŸ“± Main app loaded in background');
                setTimeout(() => {
                    testVocabAccess();
                }, 5000);
            };
            document.body.appendChild(iframe);
        });
    </script>
</body>
</html>